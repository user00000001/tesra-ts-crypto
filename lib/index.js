module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=10)}([function(t,e){t.exports=require("crypto")},function(t,e){t.exports=require("long")},function(t,e){t.exports=require("big-integer")},function(t,e){t.exports=require("elliptic")},function(t,e){t.exports=require("js-sha3")},function(t,e){t.exports=require("bytebuffer")},function(t,e){t.exports=require("bs58")},function(t,e){t.exports=require("bip39-lite")},function(t,e){t.exports=require("hdkey-secp256r1")},function(t,e){t.exports=require("scrypt-async")},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"sha256",(function(){return H})),r.d(n,"md160",(function(){return C}));var i={};r.r(i),r.d(i,"bigIntToBytes",(function(){return B})),r.d(i,"bigIntFromBytes",(function(){return P}));var s={};r.r(s),r.d(s,"PUSH0",(function(){return U})),r.d(s,"PUSHF",(function(){return x})),r.d(s,"PUSHBYTES1",(function(){return K})),r.d(s,"PUSHBYTES75",(function(){return O})),r.d(s,"PUSHDATA1",(function(){return k})),r.d(s,"PUSHDATA2",(function(){return I})),r.d(s,"PUSHDATA4",(function(){return T})),r.d(s,"PUSHM1",(function(){return N})),r.d(s,"PUSH1",(function(){return L})),r.d(s,"PUSHT",(function(){return R})),r.d(s,"PUSH2",(function(){return z})),r.d(s,"PUSH3",(function(){return J})),r.d(s,"PUSH4",(function(){return M})),r.d(s,"PUSH5",(function(){return _})),r.d(s,"PUSH6",(function(){return j})),r.d(s,"PUSH7",(function(){return V})),r.d(s,"PUSH8",(function(){return F})),r.d(s,"PUSH9",(function(){return q})),r.d(s,"PUSH10",(function(){return W})),r.d(s,"PUSH11",(function(){return Y})),r.d(s,"PUSH12",(function(){return X})),r.d(s,"PUSH13",(function(){return G})),r.d(s,"PUSH14",(function(){return Z})),r.d(s,"PUSH15",(function(){return Q})),r.d(s,"PUSH16",(function(){return $})),r.d(s,"NOP",(function(){return tt})),r.d(s,"JMP",(function(){return et})),r.d(s,"JMPIF",(function(){return rt})),r.d(s,"JMPIFNOT",(function(){return nt})),r.d(s,"CALL",(function(){return it})),r.d(s,"RET",(function(){return st})),r.d(s,"APPCALL",(function(){return ut})),r.d(s,"SYSCALL",(function(){return ot})),r.d(s,"TAILCALL",(function(){return at})),r.d(s,"DUPFROMALTSTACK",(function(){return ct})),r.d(s,"TOALTSTACK",(function(){return dt})),r.d(s,"FROMALTSTACK",(function(){return ht})),r.d(s,"XDROP",(function(){return ft})),r.d(s,"XSWAP",(function(){return lt})),r.d(s,"XTUCK",(function(){return wt})),r.d(s,"DEPTH",(function(){return St})),r.d(s,"DROP",(function(){return yt})),r.d(s,"DUP",(function(){return pt})),r.d(s,"NIP",(function(){return At})),r.d(s,"OVER",(function(){return mt})),r.d(s,"PICK",(function(){return gt})),r.d(s,"ROLL",(function(){return Et})),r.d(s,"ROT",(function(){return bt})),r.d(s,"SWAP",(function(){return Dt})),r.d(s,"TUCK",(function(){return Ht})),r.d(s,"CAT",(function(){return Ct})),r.d(s,"SUBSTR",(function(){return vt})),r.d(s,"LEFT",(function(){return Bt})),r.d(s,"RIGHT",(function(){return Pt})),r.d(s,"SIZE",(function(){return Ut})),r.d(s,"INVERT",(function(){return xt})),r.d(s,"AND",(function(){return Kt})),r.d(s,"OR",(function(){return Ot})),r.d(s,"XOR",(function(){return kt})),r.d(s,"EQUAL",(function(){return It})),r.d(s,"INC",(function(){return Tt})),r.d(s,"DEC",(function(){return Nt})),r.d(s,"SIGN",(function(){return Lt})),r.d(s,"NEGATE",(function(){return Rt})),r.d(s,"ABS",(function(){return zt})),r.d(s,"NOT",(function(){return Jt})),r.d(s,"NZ",(function(){return Mt})),r.d(s,"ADD",(function(){return _t})),r.d(s,"SUB",(function(){return jt})),r.d(s,"MUL",(function(){return Vt})),r.d(s,"DIV",(function(){return Ft})),r.d(s,"MOD",(function(){return qt})),r.d(s,"SHL",(function(){return Wt})),r.d(s,"SHR",(function(){return Yt})),r.d(s,"BOOLAND",(function(){return Xt})),r.d(s,"BOOLOR",(function(){return Gt})),r.d(s,"NUMEQUAL",(function(){return Zt})),r.d(s,"NUMNOTEQUAL",(function(){return Qt})),r.d(s,"LT",(function(){return $t})),r.d(s,"GT",(function(){return te})),r.d(s,"LTE",(function(){return ee})),r.d(s,"GTE",(function(){return re})),r.d(s,"MIN",(function(){return ne})),r.d(s,"MAX",(function(){return ie})),r.d(s,"WITHIN",(function(){return se})),r.d(s,"SHA1",(function(){return ue})),r.d(s,"SHA256",(function(){return oe})),r.d(s,"HASH160",(function(){return ae})),r.d(s,"HASH256",(function(){return ce})),r.d(s,"CHECKSIG",(function(){return de})),r.d(s,"VERIFY",(function(){return he})),r.d(s,"CHECKMULTISIG",(function(){return fe})),r.d(s,"ARRAYSIZE",(function(){return le})),r.d(s,"PACK",(function(){return we})),r.d(s,"UNPACK",(function(){return Se})),r.d(s,"PICKITEM",(function(){return ye})),r.d(s,"SETITEM",(function(){return pe})),r.d(s,"NEWARRAY",(function(){return Ae})),r.d(s,"NEWSTRUCT",(function(){return me})),r.d(s,"NEWMAP",(function(){return ge})),r.d(s,"APPEND",(function(){return Ee})),r.d(s,"REVERSE",(function(){return be})),r.d(s,"REMOVE",(function(){return De})),r.d(s,"HASKEY",(function(){return He})),r.d(s,"KEYS",(function(){return Ce})),r.d(s,"VALUES",(function(){return ve})),r.d(s,"THROW",(function(){return Be})),r.d(s,"THROWIFNOT",(function(){return Pe}));class u{constructor(t,e,r){this.label=t,this.hex=e,this.preset=r,u.values.push(this)}static fromHex(t){const e=u.values.find(e=>e.hex===t);if(void 0===e)throw new Error("Enum value not found");return e}static fromLabel(t){const e=u.values.find(e=>e.label===t);if(void 0===e)throw new Error("Enum value not found");return e}}u.values=[],u.SECP224R1=new u("P-224",1,"p224"),u.SECP256R1=new u("P-256",2,"p256"),u.SECP384R1=new u("P-384",3,"p384"),u.SECP521R1=new u("P-521",4,"p521"),u.ED25519=new u("ed25519",25,"ed25519");var o=r(0),a=r(4);const c="ECDSA",d={curve:"P-256"};class h{constructor(t,e,r){this.label=t,this.hex=e,this.labelJWS=r,h.values.push(this)}static fromHex(t){const e=h.values.find(e=>e.hex===t);if(void 0===e)throw new Error("Enum value not found");return e}static fromLabel(t){const e=h.values.find(e=>e.label===t);if(void 0===e)throw new Error("Enum value not found");return e}static fromLabelJWS(t){const e=h.values.find(e=>e.labelJWS===t);if(void 0===e)throw new Error("Enum value not found");return e}}h.values=[],h.ECDSAwithSHA224=new h("SHA224withECDSA",0,"ES224"),h.ECDSAwithSHA256=new h("SHA256withECDSA",1,"ES256"),h.ECDSAwithSHA384=new h("SHA384withECDSA",2,"ES384"),h.ECDSAwithSHA512=new h("SHA512withECDSA",3,"ES512"),h.ECDSAwithSHA3_224=new h("SHA3-224withECDSA",4,"ES3-224"),h.ECDSAwithSHA3_256=new h("SHA3-256withECDSA",5,"ES3-256"),h.ECDSAwithSHA3_384=new h("SHA3-384withECDSA",6,"ES3-384"),h.ECDSAwithSHA3_512=new h("SHA3-512withECDSA",7,"ES3-512"),h.ECDSAwithRIPEMD160=new h("RIPEMD160withECDSA",8,"ER160"),h.EDDSAwithSHA512=new h("SHA512withEdDSA",10,"EDS512");class f{constructor(t,e,r){this.label=t,this.hex=e,this.defaultSchema=r,f.values.push(this)}static fromHex(t){const e=f.values.find(e=>e.hex===t);if(void 0===e)throw new Error("Enum value not found");return e}static fromLabel(t){const e=f.values.find(e=>e.label===t);if(void 0===e)throw new Error("Enum value not found");return e}}f.values=[],f.ECDSA=new f("ECDSA",18,h.ECDSAwithSHA256),f.EDDSA=new f("EDDSA",20,h.EDDSAwithSHA512);class l{constructor(t,e,r){"string"==typeof t&&(t=new Buffer(t,"hex")),this.key=t,void 0===e&&(e=f.fromLabel(c)),void 0===r&&(r=new w(u.fromLabel(d.curve))),this.algorithm=e,this.parameters=r}computeHash(t,e){if(e===h.ECDSAwithSHA224){const e=Object(o.createHash)("sha224");return e.update(t),e.digest()}if(e===h.ECDSAwithSHA256){const e=Object(o.createHash)("sha256");return e.update(t),e.digest()}if(e===h.ECDSAwithSHA384){const e=Object(o.createHash)("sha384");return e.update(t),e.digest()}if(e===h.ECDSAwithSHA3_512||e===h.EDDSAwithSHA512){const e=Object(o.createHash)("sha512");return e.update(t),e.digest()}if(e===h.ECDSAwithRIPEMD160){const e=Object(o.createHash)("ripemd160");return e.update(t),e.digest()}if(e===h.ECDSAwithSHA3_224)return new Buffer(a.sha3_224.arrayBuffer(t));if(e===h.ECDSAwithSHA3_256)return new Buffer(a.sha3_256.arrayBuffer(t));if(e===h.ECDSAwithSHA3_384)return new Buffer(a.sha3_384.arrayBuffer(t));if(e===h.ECDSAwithSHA3_512)return new Buffer(a.sha3_512.arrayBuffer(t));throw new Error("Unsupported hash algorithm.")}isSchemaSupported(t){switch(t){case h.ECDSAwithSHA224:case h.ECDSAwithSHA256:case h.ECDSAwithSHA384:case h.ECDSAwithSHA512:case h.ECDSAwithSHA3_224:case h.ECDSAwithSHA3_256:case h.ECDSAwithSHA3_384:case h.ECDSAwithSHA3_512:case h.ECDSAwithRIPEMD160:return this.algorithm===f.ECDSA;case h.EDDSAwithSHA512:return this.algorithm===f.EDDSA;default:throw new Error("Unsupported signature schema.")}}}class w{constructor(t){this.curve=t}static deserializeJson(t){return new w(u.fromLabel(t.curve))}serializeJson(){return{curve:this.curve.label}}}var S=r(3),y=r(5),p=r(1);class A{constructor(t){this.reader=y.wrap(t,"utf-8",!0)}readByte(){return this.reader.readUint8()}readBytes(t){return new Buffer(this.reader.readBytes(t).toBuffer())}readUInt16(){return this.reader.readUint16()}readUInt32(){return this.reader.readUint32()}readUInt64(){return this.reader.readUint64()}readInt16(){return this.reader.readInt16()}readInt32(){return this.reader.readInt32()}readInt64(){return this.reader.readInt64()}position(){return this.reader.offset}length(){return this.reader.limit}seek(t,e){if("start"===e){const e=this.reader.offset;return this.reader.offset=t,e}if("relative"===e){const e=this.reader.offset;return this.reader.offset=e+t,e}throw new Error("Unsupported Whence")}readVarBytes(t){const e=this.readVarUInt(void 0!==t?p.fromNumber(t):void 0).toNumber();return this.readBytes(e)}readVarInt(t){const e=this.readByte();let r;switch(e){case 253:r=p.fromNumber(this.readUInt16());break;case 254:r=p.fromNumber(this.readUInt32());break;case 255:r=this.readUInt64();break;default:r=p.fromNumber(e)}return void 0!==t&&r.gt(t)?p.ZERO:r}readVarUInt(t){const e=this.readByte();let r;switch(e){case 253:r=p.fromNumber(this.readInt16());break;case 254:r=p.fromNumber(this.readInt32());break;case 255:r=this.readInt64();break;default:r=p.fromNumber(e)}return void 0!==t&&r.gt(t)?p.ZERO:r}readVarString(t){return this.readVarBytes(t).toString("utf-8")}}class m{constructor(){this.writer=new y(void 0,!0,!0)}getBytes(){this.writer.mark(),this.writer.flip();const t=new Buffer(this.writer.toBuffer());return this.writer.reset(),t}writeVarUint(t){"number"==typeof t&&(t=p.fromNumber(t)),t.lt(253)?this.writer.writeUint8(t.toNumber()):t.lte(65535)?(this.writer.writeUint8(253),this.writer.writeUint16(t.toNumber())):t.lte(4294967295)?(this.writer.writeUint8(254),this.writer.writeUint32(t.toNumber())):(this.writer.writeUint8(255),this.writer.writeUint64(t))}writeVarBytes(t){this.writeVarUint(t.length),this.writeBytes(t)}writeString(t){return this.writeVarBytes(new Buffer(t,"utf-8"))}writeBytes(t){this.writer.append(t)}writeUint8(t){this.writer.writeUint8(t)}writeUint16(t){this.writer.writeUint16(t)}writeUint32(t){this.writer.writeUint32(t)}writeUint64(t){this.writer.writeUint64(t)}}class g extends l{static deserialize(t){const e=new A(t);if(33===t.length){const t=f.ECDSA,r=u.SECP256R1,n=e.readBytes(33);return new g(n,t,new w(r))}{const t=e.readByte(),r=e.readByte(),n=e.readBytes(e.length()-2);return new g(n,f.fromHex(t),new w(u.fromHex(r)))}}static compare(t,e){if(t.algorithm!==e.algorithm)return t.algorithm.hex-e.algorithm.hex;switch(t.algorithm){case f.ECDSA:const r=new S.ec(t.parameters.curve.preset),n=r.keyFromPublic(t.key,"hex"),i=r.keyFromPublic(e.key,"hex"),s=n.getPublic(),u=i.getPublic();return s.getX()!==u.getX()?s.getX()-u.getX():s.getY()-u.getY();case f.EDDSA:return Number(t.key.toString("hex"))-Number(e.key.toString("hex"));default:return 0}}serialize(){const t=new m;switch(this.algorithm){case f.ECDSA:t.writeBytes(this.key);break;case f.EDDSA:t.writeUint8(this.algorithm.hex),t.writeUint8(this.parameters.curve.hex),t.writeBytes(this.key)}return t.getBytes()}async verify(t,e){if(!this.isSchemaSupported(e.algorithm))throw new Error("Signature schema does not match key type.");t instanceof Buffer||(t=t.getSignContent());const r=this.computeHash(t,e.algorithm);return this.verifySignature(r,e.value,e.algorithm)}verifySignature(t,e,r){switch(r){case h.ECDSAwithSHA224:case h.ECDSAwithSHA256:case h.ECDSAwithSHA384:case h.ECDSAwithSHA512:case h.ECDSAwithSHA3_224:case h.ECDSAwithSHA3_256:case h.ECDSAwithSHA3_384:case h.ECDSAwithSHA3_512:case h.ECDSAwithRIPEMD160:return this.verifyEcDSASignature(t,e);case h.EDDSAwithSHA512:return this.verifyEdDSASignature(t,e);default:throw new Error("Unsupported signature schema.")}}verifyEcDSASignature(t,e){const r=e.slice(0,32),n=e.slice(32,64);return new S.ec(this.parameters.curve.preset).verify(t,{r:r,s:n},this.key,"hex")}verifyEdDSASignature(t,e){const r=e.slice(0,64),n=e.slice(64,64);return new S.eddsa(this.parameters.curve.preset).verify(t,{r:r,s:n},this.key,"hex")}}class E{constructor(t,e){this.algorithm=t,this.value=e}static deserialize(t){if(t.length<2)throw new Error("Invalid params.");if(64===t.length){const e=h.ECDSAwithSHA256;return new E(e,t)}{const e=new A(t),r=e.readByte(),n=h.fromHex(r),i=e.readBytes(e.length()-e.position());return new E(n,i)}}serialize(){const t=new m;return t.writeUint8(this.algorithm.hex),t.writeBytes(this.value),t.getBytes()}}class b extends l{static random(t,e){return void 0===t&&(t=f.ECDSA),void 0===e&&(e=new w(u.SECP256R1)),new b(Object(o.randomBytes)(32),t,e)}static deserialize(t){const e=new A(t);if(32===t.length){const t=f.ECDSA,r=u.SECP256R1,n=e.readBytes(32);return new b(n,t,new w(r))}{const t=e.readByte(),r=e.readByte(),n=e.readBytes(32);return new b(n,f.fromHex(t),new w(u.fromHex(r)))}}getPublicKey(){switch(this.algorithm){case f.ECDSA:return this.getEcDSAPublicKey();case f.EDDSA:return this.getEdDSAPublicKey();default:throw new Error("Unsupported signature schema.")}}async sign(t,e){if(void 0===e&&(e=this.algorithm.defaultSchema),!this.isSchemaSupported(e))throw new Error("Signature schema does not match key type.");t instanceof Buffer||(t=t.getSignContent());const r=this.computeHash(t,e),n=this.computeSignature(r,e);return new E(e,n)}computeSignature(t,e){switch(e){case h.ECDSAwithSHA224:case h.ECDSAwithSHA256:case h.ECDSAwithSHA384:case h.ECDSAwithSHA512:case h.ECDSAwithSHA3_224:case h.ECDSAwithSHA3_256:case h.ECDSAwithSHA3_384:case h.ECDSAwithSHA3_512:case h.ECDSAwithRIPEMD160:return this.computeEcDSASignature(t);case h.EDDSAwithSHA512:return this.computeEdDSASignature(t);default:throw new Error("Unsupported signature schema.")}}computeEcDSASignature(t){const e=new S.ec(this.parameters.curve.preset).sign(t,this.key,{canonical:!0,pers:void 0});return Buffer.concat([e.r.toArrayLike(Buffer,"be",32),e.s.toArrayLike(Buffer,"be",32)])}computeEdDSASignature(t){const e=new S.eddsa(this.parameters.curve.preset).sign(t,this.key,null);return Buffer.concat([e.R.toArrayLike(Buffer,"be",32),e.S.toArrayLike(Buffer,"be",32)])}getEcDSAPublicKey(){const t=new S.ec(this.parameters.curve.preset).keyFromPrivate(this.key,"hex").getPublic(!0,"hex");return new g(t,this.algorithm,this.parameters)}getEdDSAPublicKey(){const t=new S.eddsa(this.parameters.curve.preset).keyFromSecret(this.key,"hex").getPublic(!0,"hex");return new g(t,this.algorithm,this.parameters)}}var D=r(6);function H(t){const e=Object(o.createHash)("sha256");return e.update(t),e.digest()}function C(t){const e=Object(o.createHash)("ripemd160");return e.update(t),e.digest()}var v=r(2);function B(t){let e=t.toArray(256).value;if(t.isZero())return new Buffer("");const r=e[0];if(t.isNegative()){for(let t=0;t<e.length;t++)e[t]=255^e[t];e=v.fromArray(e,256).add(v.one).toArray(256).value,e=e.reverse(),r>>7==1&&(e=e.concat(255))}else e=e.reverse(),r>>7==1&&(e=e.concat(0));return new Buffer(e)}function P(t){if(0===t.length)return v.zero;let e=Array.from(t.subarray(0));if(e=e.reverse(),e[0]>>7==1){for(let t=0;t<e.length;t++)e[t]=255^e[t];return e=v.fromArray(e,256).add(v(1)).toArray(256).value,v.fromArray(e,256).negate()}return v.fromArray(e,256)}const U=0,x=U,K=1,O=75,k=76,I=77,T=78,N=79,L=81,R=L,z=82,J=83,M=84,_=85,j=86,V=87,F=88,q=89,W=90,Y=91,X=92,G=93,Z=94,Q=95,$=96,tt=97,et=98,rt=99,nt=100,it=101,st=102,ut=103,ot=104,at=105,ct=106,dt=107,ht=108,ft=109,lt=114,wt=115,St=116,yt=117,pt=118,At=119,mt=120,gt=121,Et=122,bt=123,Dt=124,Ht=125,Ct=126,vt=127,Bt=128,Pt=129,Ut=130,xt=131,Kt=132,Ot=133,kt=134,It=135,Tt=139,Nt=140,Lt=141,Rt=143,zt=144,Jt=145,Mt=146,_t=147,jt=148,Vt=149,Ft=150,qt=151,Wt=152,Yt=153,Xt=154,Gt=155,Zt=156,Qt=158,$t=159,te=160,ee=161,re=162,ne=163,ie=164,se=165,ue=167,oe=168,ae=169,ce=170,de=172,he=173,fe=174,le=192,we=193,Se=194,ye=195,pe=196,Ae=197,me=198,ge=199,Ee=200,be=201,De=202,He=203,Ce=204,ve=205,Be=240,Pe=241;class Ue{constructor(){this.w=new m}pushPubKey(t){this.pushBytes(t.serialize())}writeOpCode(t){this.w.writeUint8(t)}writeByte(t){this.w.writeUint8(t)}writeBytes(t){this.w.writeBytes(t)}writeVarUInt(t){this.w.writeVarUint(t)}pushBytes(t){t.length<=O+1-K?this.w.writeUint8(t.length+K-1):t.length<256?(this.w.writeUint8(k),this.w.writeUint8(t.length)):t.length<65536?(this.w.writeUint8(I),this.w.writeUint16(t.length)):(this.w.writeUint8(T),this.w.writeUint32(t.length)),this.w.writeBytes(t)}pushNum(t){"number"==typeof t&&(t=p.fromNumber(t)),t.eq(-1)?this.writeOpCode(N):t.isZero()?this.writeOpCode(U):t.gt(0)&&t.lt(16)?this.writeOpCode(t.toNumber()-1+L):this.pushBytes(B(v(t.toString())))}pushBool(t){t?this.writeOpCode(R):this.writeOpCode(x)}getProgram(){return this.w.getBytes()}}function xe(t){const e=new Ue;return e.pushPubKey(t),e.writeOpCode(de),e.getProgram()}function Ke(t,e){if(1===t)return xe(e[0]);const r=e.length;if(!(1<=t&&t<=r&&r<=1024))throw new Error("Wrong multi-sig param");e.sort(g.compare);const n=new Ue;return n.pushNum(t),e.forEach(t=>{n.pushPubKey(t)}),n.pushNum(r),n.writeOpCode(fe),n.getProgram()}function Oe(t){const e=new Ue;for(const r of t)e.pushBytes(r);return e.getProgram()}class ke{constructor(t="0000000000000000000000000000000000000000"){this.value="string"==typeof t?new Buffer(t,"hex"):t}static deserialize(t){const e=new A(t);try{const t=e.readBytes(20);return new ke(t)}catch(t){throw new Error("deserialize Uint256 error")}}static fromVmCode(t){return new ke(C(H(t)))}static fromPubKey(t){const e=xe(t);return ke.fromVmCode(e)}static fromBase58(t){const e=D.decode(t),r=new Buffer(e).slice(1,21),n=new ke(r);if(t!==n.toBase58())throw new Error("[Address.fromBase58] decode encoded verify failed");return n}equals(t){return this.value.equals(t.value)}serialize(t){t.writeBytes(this.value)}toArray(){const t=new Buffer(this.value.length);return this.value.copy(t),t}toBase58(){const t=Buffer.concat([new Buffer("17","hex"),this.value]),e=H(t),r=H(e).slice(0,4),n=Buffer.concat([t,r]);return D.encode(n)}toTstId(){return"did:tst:"+this.toBase58()}}var Ie=r(7),Te=r(8),Ne=r(9);function Le(t,e){var r={};for(var n in t)e.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r}const Re={N:4096,r:8,p:8,keyLength:64};function ze(t,e,r,n,i){const{keyLength:s}=i,u=Le(i,["keyLength"]),a=Buffer.from(t,"base64"),c=a.slice(0,a.length-16),d=a.slice(a.length-16),h=Me(n.normalize("NFC"),r,s,u),f=h.slice(0,12),l=h.slice(32),w=f,S=new Buffer(e),y=Object(o.createDecipheriv)("aes-256-gcm",l,w);y.setAAD(S),y.setAuthTag(d);let p=y.update(c).toString("hex");try{p+=y.final().toString("hex")}catch(t){throw new Error("Password incorrect")}return p}function Je(t,e,r,n,i){const{keyLength:s}=i,u=Le(i,["keyLength"]),a=Me(n.normalize("NFC"),r,s,u),c=a.slice(0,12),d=a.slice(32),h=c,f=new Buffer(e),l=Object(o.createCipheriv)("aes-256-gcm",d,h);l.setAAD(f);let w=l.update(t);const S=l.final(),y=l.getAuthTag();return w=Buffer.concat([w,S]),Buffer.concat([w,y]).toString("base64")}function Me(t,e,r,n){let i=[];const s=Array.from(e.subarray(0));return Ne(t.normalize("NFC"),s,{N:n.N,r:n.r,p:n.p,dkLen:r},t=>{i=t}),new Buffer(i)}class _e{constructor(){this["enc-alg"]="aes-256-gcm",this.hash="sha256"}static import(t,e,r,n=Object(o.randomBytes)(16),i=Re){const s=new _e;if(t||(t=Object(o.randomBytes)(4).toString("hex")),s.label=t,s.lock=!1,s.isDefault=!1,s.salt=n.toString("base64"),s.scrypt=i,s.publicKey=e.getPublicKey(),s.address=ke.fromPubKey(s.publicKey),s.encryptedKey=Je(e.key,s.address.toBase58(),n,r,i),!s.address.equals(s.address))throw new Error("Computed address does not match the provided address.");return s}static importMnemonic(t,e,r,n=Re){if(e=e.trim(),!Object(Ie.validateMnemonic)(e))throw new Error("Invalid mnemonics");const i=Object(Ie.toSeedHex)(e),s=Te.HDKey.fromMasterSeed(Buffer.from(i,"hex")).derive("m/44'/1024'/0'/0/0"),u=Buffer.from(s.privateKey).toString("hex"),o=new b(u);return _e.create(t,o,r,n)}static create(t,e,r,n=Re){const i=new _e,s=Object(o.randomBytes)(16),u=e.getPublicKey(),a=ke.fromPubKey(u);return i.label=t,i.lock=!1,i.isDefault=!1,i.publicKey=u,i.address=a,i.encryptedKey=Je(e.key,a.toBase58(),s,r,n),i.salt=s.toString("base64"),i.scrypt=n,i}static deserializeJson(t,e=Re){"string"==typeof t&&(t=JSON.parse(t));const r=new g(new Buffer(t.publicKey,"hex"),f.fromLabel(t.algorithm),w.deserializeJson(t.parameters)),n=new _e;return n.address=ke.fromBase58(t.address),n.label=t.label,n.lock=t.lock,n.isDefault=t.isDefault,n.publicKey=r,n.hash=t.hash,n.salt=t.salt,n.encryptedKey=t.key,n.extra=t.extra,n.scrypt=e,n}serializeJson(t=!1){const e={address:this.address.toBase58(),label:this.label,lock:this.lock,extra:this.extra,key:this.encryptedKey,"enc-alg":this["enc-alg"],hash:this.hash,salt:this.salt,isDefault:this.isDefault,publicKey:this.publicKey.serialize().toString("hex"),algorithm:this.publicKey.algorithm.label,parameters:this.publicKey.parameters.serializeJson()};return t?JSON.stringify(e):e}decryptKey(t){const e=Buffer.from(this.salt,"base64"),r=ze(this.encryptedKey,this.address.toBase58(),e,t,this.scrypt);return new b(r,this.publicKey.algorithm,this.publicKey.parameters)}}class je{constructor(){this.controls=[]}static importIdentity(t,e,r,n=Object(o.randomBytes)(16),i=Re){const s=new je;t||(t=Object(o.randomBytes)(4).toString("hex"));const u=e.getPublicKey(),a=ke.fromPubKey(u),c={id:"1",encryptedKey:Je(e.key,a.toBase58(),n,r,i),address:a,salt:n.toString("base64"),hash:"sha256","enc-alg":"aes-256-gcm",publicKey:u,scrypt:i};return s.label=t,s.lock=!1,s.isDefault=!1,s.tstid=ke.fromPubKey(u).toTstId(),s.controls=[c],s.scrypt=i,s}static create(t,e,r,n=Re){const i=new je,s=Object(o.randomBytes)(16),u=e.getPublicKey(),a=ke.fromPubKey(u),c={id:"1",encryptedKey:Je(e.key,a.toBase58(),s,r,n),address:a,salt:s.toString("base64"),hash:"sha256","enc-alg":"aes-256-gcm",publicKey:u};return i.label=t,i.lock=!1,i.isDefault=!1,i.tstid=ke.fromPubKey(u).toTstId(),i.controls=[c],i.scrypt=n,i}static deserializeControlsJson(t){return t.map(t=>{const e=new g(new Buffer(t.publicKey,"hex"),f.fromLabel(t.algorithm),w.deserializeJson(t.parameters));return{id:t.id,encryptedKey:t.key,address:ke.fromBase58(t.address),salt:t.salt,hash:t.hash,"enc-alg":t["enc-alg"],publicKey:e}})}static deserializeJson(t,e=Re){"string"==typeof t&&(t=JSON.parse(t));const r=new je;return r.label=t.label,r.lock=t.lock,r.tstid=t.tstid,r.isDefault=t.isDefault,r.extra=t.extra,r.controls=je.deserializeControlsJson(t.controls),r.scrypt=e,r}serializeControlsJson(t=!1){const e=this.controls.map(t=>({key:t.encryptedKey,id:t.id,address:t.address.toBase58(),salt:t.salt,"enc-alg":t["enc-alg"],hash:t.hash,publicKey:t.publicKey.serialize().toString("hex"),algorithm:t.publicKey.algorithm.label,parameters:t.publicKey.parameters.serializeJson()}));return t?JSON.stringify(e):e}serializeJson(t=!1){const e={tstid:this.tstid,label:this.label,lock:this.lock,isDefault:this.isDefault,extra:this.extra,controls:this.serializeControlsJson(!1)};return t?JSON.stringify(e):e}decryptKey(t,e){const r=this.controls.find(e=>e.id===t);if(void 0===r)throw new Error("ControlData not found.");const n=Buffer.from(r.salt,"base64"),i=ze(r.encryptedKey,r.address.toBase58(),n,e,this.scrypt);return new b(i,r.publicKey.algorithm,r.publicKey.parameters)}}class Ve{static constructAddress(t){let e;return e="string"==typeof t?40===t.length?new ke(t):ke.fromBase58(t):t,e}static create(){const t=new Ve;return t.name=name,t.accounts=[],t.identities=[],t.createTime=(new Date).toISOString(),t.version="1.0",t.scrypt=Re,t.keyLength=64,t}static deserializeJson(t){"string"==typeof t&&(t=JSON.parse(t));const e=new Ve;return e.name=t.name,e.defaultTstid=t.defaultTstid,e.defaultAccountAddress=t.defaultAccountAddress,e.createTime=t.createTime,e.version=t.version,e.scrypt={N:t.scrypt.n,r:t.scrypt.r,p:t.scrypt.p,keyLength:t.scrypt.dkLen},e.identities=void 0!==t.identities?t.identities.map(t=>je.deserializeJson(t,e.scrypt)):[],e.accounts=void 0!==t.accounts?t.accounts.map(t=>_e.deserializeJson(t,e.scrypt)):[],e.extra=t.extra,e}addAccount(t){for(const e of this.accounts)if(e.address.equals(t.address))return;this.accounts.push(t)}delAccount(t){const e=Ve.constructAddress(t);this.accounts=this.accounts.filter(t=>!t.address.equals(e))}getAccount(t){const e=Ve.constructAddress(t);return this.accounts.find(t=>t.address.equals(e))}addIdentity(t){for(const e of this.identities)if(e.tstid===t.tstid)return;this.identities.push(t)}delIdentity(t){this.identities=this.identities.filter(e=>!(e.tstid===t))}getIdentity(t){return this.identities.find(e=>e.tstid===t)}setDefaultAccount(t){this.defaultAccountAddress=t}setDefaultIdentity(t){this.defaultTstid=t}serializeJson(t=!1){const e={name:this.name,defaultTstid:this.defaultTstid,defaultAccountAddress:this.defaultAccountAddress,createTime:this.createTime,version:this.version,scrypt:{n:this.scrypt.N,r:this.scrypt.r,p:this.scrypt.p,dkLen:this.scrypt.keyLength},identities:this.identities.map(t=>t.serializeJson(!1)),accounts:this.accounts.map(t=>t.serializeJson(!1)),extra:null};return t?JSON.stringify(e):e}}r.d(e,"CurveLabel",(function(){return u})),r.d(e,"Key",(function(){return l})),r.d(e,"PublicKey",(function(){return g})),r.d(e,"PrivateKey",(function(){return b})),r.d(e,"Signature",(function(){return E})),r.d(e,"SignatureScheme",(function(){return h})),r.d(e,"KeyType",(function(){return f})),r.d(e,"Address",(function(){return ke})),r.d(e,"Account",(function(){return _e})),r.d(e,"Identity",(function(){return je})),r.d(e,"Wallet",(function(){return Ve})),r.d(e,"ProgramBuilder",(function(){return Ue})),r.d(e,"programFromMultiPubKeys",(function(){return Ke})),r.d(e,"programFromParams",(function(){return Oe})),r.d(e,"programFromPubKey",(function(){return xe})),r.d(e,"Reader",(function(){return A})),r.d(e,"Writer",(function(){return m})),r.d(e,"OpCode",(function(){return s})),r.d(e,"Hash",(function(){return n})),r.d(e,"Serialize",(function(){return i}))}]);
//# sourceMappingURL=index.js.map